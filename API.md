# User Microservice API Documentation

## API Requirements

The API should be designed to be stateless and should follow RESTful
principles. It should use JSON as the data format for requests and responses.
The API should be secured using JWT (JSON Web Tokens) for authentication and
authorization. The API should also provide proper error handling and return
appropriate HTTP status codes for success and failure scenarios. The API should
be documented using OpenAPI 3.0 specification, and the documentation should be
available in a user-friendly format, such as Swagger UI.

## Base Information

- **Base URL**: `http://localhost:8080`
- **API Version**: v1
- **Content Type**: `application/json`
- **Authentication**: JWT Bearer Token

## Documentation Links

- **Swagger UI**: http://localhost:8080/swagger-ui.html
- **OpenAPI 3.1 JSON**: http://localhost:8080/v3/api-docs
- **OpenAPI 3.1 YAML**: http://localhost:8080/v3/api-docs.yaml

## Set of APIs

### Base URL

http://localhost:8080/api

### Create User Account API

The API to create the user account should provide as inputs an email
and password. It should ensure that the email is unique. Upon
validation the API should store the information provided in a single
table in a MariaDB database. The record created should contain a unique
generated UUID for the user's id or primary key of that table.

The API should also add a time and date timestamp of when the account was
created. This timestamp should be stored in the same table using the UTC
timezone. The API should also generate and store a random token that will be
used to confirm the creation of the user account. This token should be stored in
the same database table along with the user account information. The token
should be a secure random UUID string that is unique for each user account. The
API should return a response with the user account information, including the
email, user ID, and a message advising the user to confirm the
creation of the account in the user's provided email. The response should also
include a status code indicating the success or failure of the operation.

If the email is not unique, the API should return an error response with a
status code indicating the conflict. If the user account is
successfully created, the API should return a status code indicating success
and the user account information in the response body.

It should also send a confirmation email to the user's provided email address
with a link to confirm the creation of the user account. The link should include
the confirmation token generated by the API. The email should contain a message
informing the user that they need to click the link to confirm their account
creation. In addition, the email should contain a message that tells the user
not to click on the link if he did not register for the user account.

The email should be sent asynchronously to avoid blocking the API
response. The email should be sent using a reliable email service provider, such
as SendGrid, Amazon SES, or similar. The email should be sent in a background
thread to ensure that the API response is not delayed. The email should be
formatted in HTML and should include a link that the user can click to confirm
their account creation. The link should point to the Confirm User Account
Creation API, which will be described below.

### Confirm User Account Creation API

The API to confirm the creation of the user account should be called by
clicking a link in the previously sent confirmation email. This API should be a
simple GET API that uses the randomly generated token which was placed there by
the previous Create User Account API implementation. The token should be stored
in the database along with the user account information. When the user clicks
the link, the token is validated and the user account is activated.

A time stamp containing the server UTC timezone time and date should be stored
in the database. This allows future tracking of when the account was activated.
Also,
once activated a flag should be set in the database to indicate that the user
account is active. The API should return a response indicating the success or
failure of the operation. If the token is valid and the user account
is successfully activated, the API should return a status code indicating
success and a message indicating that the user account has been successfully
confirmed. If the token is invalid or the user account is already confirmed, the
API should return an error response with a status code indicating the conflict
or bad request.

### Request to Change User Account Password API

The API to request a change of the user's account password should provide as
inputs the user's email. The API should validate that the user exists in the
database. If the user exists, the API should generate a secure random token
and send an email to the user's provided email address with a link to change
the user's account password. The link should include the generated token. The
email should contain a message informing the user that they need to click the
link to change their account password.

The email should be sent asynchronously to avoid blocking the API response. The
email should be sent using a reliable email service provider, such as SendGrid,
Amazon SES, or similar. The email should be sent in a background thread to
ensure that the API response is not delayed. The email should be formatted in
HTML and should include a link that the user can click to change their account
password. The link should point to the Change User Account Password API, which
will be described below. If the user does not exist, the API should return an
error response with a status code indicating the not found error. If the user
exists, the API should return a status code indicating success and a message 
indicating that the password change request has been successfully sent. The API 
should also ensure that the user has not requested a password change in the 
last 24 hours to prevent abuse.

### Change User Account Password API

The API to change the user's account password should provide as inputs the
user's email, the new password and the token generated in the previous Request
to Change User Account Password API. The API should validate that the user
exists in the database and that the new password meets the required security standards.
It should also validate that the token is valid and has not expired. The token
should be stored in the database along with the user account information. The
API should check that the token is not older than 24 hours. If the token is
valid, the API should update the user's password in the database and return a
response indicating the success or failure of the operation. The API should also
ensure that the new password is different from the old password. If the user
does not exist, the API should return an error response with a status code indicating
the not found error. If the new password does not meet the required security
standards, the API should return an error response with a status code indicating
the bad request error. If the token is invalid or has expired, the API should
return an error response with a status code indicating the unauthorized error.
If the password is successfully changed, the API should return a status code
indicating success and a message indicating that the password has been
successfully changed.

If the user exists, the API should update the user's password in the database
and return a response indicating the success or failure of the operation. The
API should also ensure that the new password is different from the old password.
If the user does not exist, the API should return an error response with a
status code indicating the not found error. If the new password does not meet the
required security standards, the API should return an error response with a
status code indicating the bad request error. If the password is successfully
changed, the API should return a status code indicating success and a message
indicating that the password has been successfully changed.

### Authenticate User API

The API to authenticate the user should provide as inputs the user's email and
password. The API should validate that the user exists in the database and that
the provided password matches the stored password. The API should use a secure
password hashing algorithm, such as bcrypt, to compare the provided password
with the stored password. If the user exists and the password is correct, the
API should generate a JWT token and return it in the response. The JWT token
should include the user's ID, email, and any other relevant information. The
API should also set an expiration time for the token, such as 1 hour. The API
should return a response with the JWT token and a status code indicating the
success or failure of the operation. If the user does not exist, the API should
return an error response with a status code indicating the not found error. If
the password is incorrect, the API should return an error response with a status
code indicating the unauthorized error. If the user is successfully
authenticated, the API should return a status code indicating success and the JWT token in the
response body.

### Display User Account Information API

The API to display the user account information should provide as inputs the
user's email. The API should validate that the user exists in the database. If
the user exists, the API should retrieve the user's account information from the
database and return it in the response. The response should include the user's
ID,  email, and any other relevant information. The API should return a
response with the user account information and a status code indicating the
success or failure of the operation. If the user does not exist, the API should
return an error response with a status code indicating the not found error. If
the user account information is successfully retrieved, the API should return a
status code indicating success and the user account information in the response
body.

## Authentication

This API uses JWT (JSON Web Token) for authentication. Include the token in the
Authorization header:

```
Authorization: Bearer <jwt-token>
```

## Endpoints

### 1. User Registration

Register a new user account.

- **URL**: `/api/user/register`
- **Method**: `POST`
- **Authentication**: Not required
- **Content-Type**: `application/json`

#### Request Body

```json
{
  "email": "john.doe@example.com",
  "password": "SecurePassword123!"
}
```

#### Response Examples

**Success (201 Created)**

```json
{
  "id": 1,
  "email": "john.doe@example.com",
  "createdAt": "2025-01-15T10:30:00Z",
  "passwordChangedAt": "2025-01-15T10:30:00Z"
}
```

**Error (400 Bad Request)**

```json
{
  "error": "VALIDATION_ERROR",
  "message": "Email already exists",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

#### cURL Example

```bash
curl -X POST http://localhost:8080/api/user/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "john.doe@example.com",
    "password": "SecurePassword123!"
  }'
```

### 2. User Authentication (Login)

Authenticate user and receive JWT token.

- **URL**: `/api/auth/login`
- **Method**: `POST`
- **Authentication**: Not required
- **Content-Type**: `application/json`

#### Request Body

```json
{
  "email": "john.doe@example.com",
  "password": "SecurePassword123!"
}
```

#### Response Examples

**Success (200 OK)**

```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "type": "Bearer",
  "expiresIn": 86400,
  "user": {
    "id": 1,
    "email": "john.doe@example.com"
  }
}
```

**Error (401 Unauthorized)**

```json
{
  "error": "AUTHENTICATION_FAILED",
  "message": "Invalid email or password",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

#### cURL Example

```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "john.doe@example.com",
    "password": "SecurePassword123!"
  }'
```

### 3. Change Password

Change user's current password (requires authentication).

- **URL**: `/api/user/change-password`
- **Method**: `PUT`
- **Authentication**: Required (JWT Bearer token)
- **Content-Type**: `application/json`

#### Request Body

```json
{
  "currentPassword": "SecurePassword123!",
  "newPassword": "NewSecurePassword456!"
}
```

#### Response Examples

**Success (200 OK)**

```json
{
  "message": "Password changed successfully",
  "passwordChangedAt": "2025-01-15T11:45:00Z"
}
```

**Error (400 Bad Request)**

```json
{
  "error": "INVALID_PASSWORD",
  "message": "Current password is incorrect",
  "timestamp": "2025-01-15T11:45:00Z"
}
```

#### cURL Example

```bash
curl -X PUT http://localhost:8080/api/user/change-password \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -d '{
    "currentPassword": "SecurePassword123!",
    "newPassword": "NewSecurePassword456!"
  }'
```

### 4. Request Password Reset

Request a password reset link to be sent via email.

- **URL**: `/api/auth/forgot-password`
- **Method**: `POST`
- **Authentication**: Not required
- **Content-Type**: `application/json`

#### Request Body

```json
{
  "email": "john.doe@example.com"
}
```

#### Response Examples

**Success (200 OK)**

```json
{
  "message": "Password reset link has been sent to your email",
  "timestamp": "2025-01-15T12:00:00Z"
}
```

**Note**: For security reasons, this endpoint always returns success, even if
the email doesn't exist.

#### cURL Example

```bash
curl -X POST http://localhost:8080/api/auth/forgot-password \
  -H "Content-Type: application/json" \
  -d '{
    "email": "john.doe@example.com"
  }'
```

### 5. Reset Password

Reset password using the token received via email.

- **URL**: `/api/auth/reset-password`
- **Method**: `POST`
- **Authentication**: Not required
- **Content-Type**: `application/json`

#### Request Body

```json
{
  "token": "reset-token-from-email",
  "newPassword": "NewSecurePassword789!"
}
```

#### Response Examples

**Success (200 OK)**

```json
{
  "message": "Password has been reset successfully",
  "timestamp": "2025-01-15T12:15:00Z"
}
```

**Error (400 Bad Request)**

```json
{
  "error": "INVALID_TOKEN",
  "message": "Reset token is invalid or expired",
  "timestamp": "2025-01-15T12:15:00Z"
}
```

#### cURL Example

```bash
curl -X POST http://localhost:8080/api/auth/reset-password \
  -H "Content-Type: application/json" \
  -d '{
    "token": "reset-token-from-email",
    "newPassword": "NewSecurePassword789!"
  }'
```

### 6. Get User Profile

Retrieve authenticated user's profile information.

- **URL**: `/api/user/profile`
- **Method**: `GET`
- **Authentication**: Required (JWT Bearer token)

#### Response Examples

**Success (200 OK)**

```json
{
  "id": 1,
  "email": "john.doe@example.com",
  "createdAt": "2025-01-15T10:30:00Z",
  "passwordChangedAt": "2025-01-15T11:45:00Z"
}
```

#### cURL Example

```bash
curl -X GET http://localhost:8080/api/user/profile \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

## Common Error Responses

### 401 Unauthorized

```json
{
  "error": "UNAUTHORIZED",
  "message": "Access token is missing or invalid",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

### 403 Forbidden

```json
{
  "error": "FORBIDDEN",
  "message": "Access denied",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

### 500 Internal Server Error

```json
{
  "error": "INTERNAL_SERVER_ERROR",
  "message": "An unexpected error occurred",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

## Request/Response Headers

### Common Request Headers

- `Content-Type: application/json`
- `Authorization: Bearer <jwt-token>` (for protected endpoints)
- `Accept: application/json`

### Common Response Headers

- `Content-Type: application/json`
- `X-Request-ID: <unique-request-id>`

## Rate Limiting

- **Rate Limit**: 100 requests per minute per IP
- **Headers**:
    - `X-RateLimit-Limit`: Maximum requests allowed
    - `X-RateLimit-Remaining`: Remaining requests
    - `X-RateLimit-Reset`: Time when rate limit resets

## Data Validation Rules

### Email

- Valid email format
- Maximum 100 characters
- Case-insensitive uniqueness

### Password

- Minimum 8 characters
- Must contain: uppercase, lowercase, number, special character
- Maximum 128 characters

## Testing with Swagger UI

1. Navigate to http://localhost:8080/swagger-ui.html
2. For protected endpoints:
    - Click "Authorize" button
    - Enter: `Bearer <your-jwt-token>`
    - Click "Authorize"
3. Expand endpoint sections to test APIs interactively